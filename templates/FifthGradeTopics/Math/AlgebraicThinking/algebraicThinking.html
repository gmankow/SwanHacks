<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Algebraic Thinking</title>
        <link rel="stylesheet" type="text/css" href="/static/unitFormats.css">
    </head>
    <body>

	<h1>Algebraic Thinking</h1>

	<ul class="main-menu">
		<li class="dropdown">
		<a href="#" class="dwopdown-toggle">Overview</a>
		<ul class="submenu">
			<li class="dropdown-level-2">
			<li><a href="/math/AlgebraicThinking/Overview">Overview</a>
			</li>
		</ul>
		</li>
	</ul>
	<ul class="main-menu">
		<li class="dropdown">

		<a href="#" class="dwopdown-toggle">Practice Assignments</a>
		<ul class="submenu">
			<li class="dropdown-level-2">
			<li><a href="/math/AlgebraicThinking/AlgebraicThinkingWorksheet">Practice Assignment 1</a>
			<li><a href="/math/AlgebraicThinking/AlgebraicThinkingWorksheet2">Practice Assignment 2</a>
			</li>
		</ul>	
		</li>
	</ul>
    <div class="button-fix">
	<ul class="main-menu">
		<li class="dropdown">

		<a href="#" class="dwopdown-toggle">Exam</a>
		<ul class="submenu">
			<li class="dropdown-level-2">
			<li><a href="/math/AlgebraicThinking/AlgebraicThinkingAssessment">View Exam</a>
			<li><button onclick="checkPasswowd()">View Answer Key</button>
			</li>
		</ul>	
		</li>
	</ul>
</div>

	<ul class="main-menu">
		<li class="dropdown">
		<a href="#" class="dwopdown-toggle">Need Help?</a>
		<ul class="submenu">
			<li class="dropdown-level-2">
			<li><select id="worksheet-select">
            <option value="">-- Select Worksheet --</option>
            <option value="/math/AlgebraicThinking/AlgebraicThinkingWorksheet">Worksheet 1</option>
            <option value="/math/AlgebraicThinking/AlgebraicThinkingWorksheet2">Worksheet 2</option>
        </select>

        <select id="section-select">
            <option value="">-- Select Section --</option>
            <option value="A">Section A</option>
            <option value="B">Section B</option>
            <option value="C">Section C</option>
            <option value="D">Section D</option>
            <option value="E">Section E</option>
            <option value="F">Section F</option>
        </select>

        <button id="global-help-btn">Ask Tutor for Help</button>
	<h2>Response:</h2>
            <div id="result" style="white-space: pre-wrap; color: #FFF; border: 1px solid #ccc; padding: 8px;"></div>
        </div>
			</li>
		</ul>
		</li>
	</ul>

	

        <script>
            document.addEventListener('DOMContentLoaded', () => {

            const helpButton = document.getElementById('global-help-btn');
            const worksheetDropdown = document.getElementById('worksheet-select');
            const sectionDropdown = document.getElementById('section-select');
            const resultEl = document.getElementById('result');

            
            helpButton.addEventListener('click', async () => {
                
                const fileName = worksheetDropdown.value; 
                const sectionClass = sectionDropdown.value;   

                if (!fileName || !sectionClass) {
                    alert("Please select both a worksheet and a section.");
                    return;
                }

                resultEl.textContent = "Loading section...";

                try {
                    const response = await fetch(fileName);
                    if (!response.ok) {
                        throw new Error(`Could not find file: ${fileName}`);
                    }
                    

                    const htmlText = await response.text();


                    const parser = new DOMParser();
                    const doc = parser.parseFromString(htmlText, 'text/html');

                    const selector = `.section.${sectionClass}`;
                    const sectionElement = doc.querySelector(selector);

           
                    if (!sectionElement) {
                        throw new Error(`Could not find section "${selector}" in ${fileName}`);
                    }
                    const sectionText = sectionElement.innerText;
                    console.log(sectionText)

                    let userMessage = "I need help on topics within this section";
                    resultEl.textContent = "Thinking...";
                    sendSectionToBot(sectionText, userMessage);

                } catch (err) {
                    console.error(err);
                    resultEl.textContent = `Error: ${err.message}`;
                }
            });
        });
	//--------------------------------------------------------------------------

        async function sendSectionToBot(sectionFullText, userMessage) {


            const resultEl = document.getElementById('result');

            try {
                const res = await fetch("/tutor", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        "question": sectionFullText + userMessage
                    }),
                });

                const data = await res.json();

                if (data.answer) {
                    resultEl.innerHTML = data.answer;
                } else if (data.error) {
                    resultEl.textContent = "Error: " + data.error;
                } else {
                    resultEl.textContent = "No 'answer' or 'error' field in response.";
                }
            } catch (err) {
                console.error("Fetch error:", err);
                resultEl.textContent = "Request failed: " + err;
            }
        }

        function checkPasswowd() {

    let passwowd = prompt("Please enter the password: ");
    

    const secwet = "kawaii123"; 
    
    if (passwowd == secwet) {
      window.location.href = "/math/AlgebraicThinking/KeyAssessments-AlgebraicThinking"; // Change this URL!
      
    } else {
      alert("Incorrect Password");
    }
  }

//-----------------------------------------------------------

  const toggles = document.querySelectorAll('.dwopdown-toggle');

  toggles.forEach(toggle => {
    
    toggle.addEventListener('click', function(event) {
      event.preventDefault(); 
      let submenu = toggle.nextElementSibling;
    
      submenu.classList.toggle('show');
    });
    
  });
        </script>
    </body>
</html>